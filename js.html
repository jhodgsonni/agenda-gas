<script>

    const NOTIFICACION_OK = 1;
    const NOTIFICACION_DANGER = 2;
    const NOTIFICACION_WARNING = 3;

function crearTablaContactos()
{
    let tabla = document.getElementById('tablaContactos');//obtiene la tabla si ya existe
    if(tabla)
    {
        tabla.remove();//si existe la tabla la elimina, para que no se duplique
    }
    //Hace la tabla hasta que la funcion obtenerContactos termine
    google.script.run.withSuccessHandler(crearTablaContactosCorrectamente).obtenerContactos()
    .withfailureHandler(creatTablaContactosError)//En caso de no obtener los contactos, se va hasta la funcion creatTablaContactosError
    .obtenerContactos();
}  

function crearTablaContactosCorrectamente(obj)//obj es el resultado de la funcion obtenerContactos
        {
           
            //creamos la tabla
            tabla = document.createElement('table');
            tabla.id = 'tablaContactos';

            let tablaHeader = document.createElement('thead');
            let tablaBody = document.createElement('tbody');

            //Empezamos creando el header de la tabla
            let primeraFila = document.createElement('tr');//creamos una fila

            for(let i=0; i<obj[0].length; i++)//saca los elementos de la cabezera
            {
                let celda = document.createElement('td');//creamos una celda por cada elemento de la matriz de excel
                    celda.textContent = obj[0][i];
                    primeraFila.appendChild(celda);//agregamos la celda a la fila pero en la pagina web
            }
            //si es la primera fila, la agregamos a la cabecera
            tablaHeader.appendChild(primeraFila);
            tabla.appendChild(tablaHeader);

            //Aqui empezamos a crear el cuerpo de la tabla
            for(let i=1; i< obj.length; i++)
            {
                let fila = document.createElement('tr');//creamos una fila
                for(let j=0; j< obj[i].length; j++)
                {
                    let celda = document.createElement('td');//creamos una celda por cada elemento de la matriz de excel
                    celda.textContent = obj[i][j];
                    fila.appendChild(celda);//agregamos la celda a la fila pero en la pagina web
                }
                    tablaBody.appendChild(fila);//agregamos la fila a la tabla pero en la pagina web
            }

            //agregamos clases a la cabecera
            tablaHeader.classList.add('table-dark');
            //agregamos el cuerpo de la tabla
            tabla.appendChild(tablaBody);
            //agregamos clases a la tabla
            tabla.classList.add('table', 'table-striped', 'border', 'border-4', 'border-dark');
            //agrega,la tabla a la pagina
            document.getElementById('divContactos').appendChild(tabla);//divContactos es el id del div que esta en Main.html
        
        //Mostrar una notificacion de exito
        crearNotificacion('NOTIFICACION_OK', 'Se han cargado los contactos correctamente', 'Todo en orden');
        }

        function creatTablaContactosError(error)
        {
            //Muestra una notificacion de error
            crearNotificacion('NOTIFICACION_DANGER', 'No se han podido leer los contactos', 'ERROR');
        }

    function crearNotificacion(tipo, mensaje, titulo)
    {
        //obtener datos de la notificacion
        let mensajeNotificacion = document.getElementById('mensajeNotificacion');//lo mostrara en el div dentro del main linea 24
        let tituloNotificacion = document.getElementById('tituloNotificacion');// lo mismo, linea 20 del main
        let elementoNotificacion = document.getElementById('notificacion');//Esto nos guarda la notificacion en una variable, main linea 16
        let iconoNotificacion = document.getElementById('iconoNotificacion');//Main linea 19
        let notificacion = bootstrap.Toast.getOrCreateInstance(elementoNotificacion);//Esta instancia es para poder mostrarla
        
        //editar los datos de la notificacion
        mensajeNotificacion.textContent = mensaje;
        tituloNotificacion.textContent = titulo;

        switch(tipo)
        {
            case NOTIFICACION_OK:
            iconoNotificacion.className = ''; //limpia el icono
            iconoNotificacion.classList.add('bi', 'bi-check2-square');//Este icono es de bootstrap
            
            elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-verde-oscuro');
            //se le esta poniendo un color a la notificacion, el color depende del tipo de notificacion de css.html
            break;

            case NOTIFICACION_DANGER:
            iconoNotificacion.className = ''; //limpia el icono
            iconoNotificacion.classList.add('bi', 'bi-bug');//Este icono es de bootstrap
            
            elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-rojo-oscuro');
            //se le esta poniendo un color a la notificacion, el color depende del tipo de notificacion de css.html
            break;

            case NOTIFICACION_WARNING:
            iconoNotificacion.className = ''; //limpia el icono
            iconoNotificacion.classList.add('bi', 'bi-exclamation-square');//Este icono es de bootstrap
            
            elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-amarillo-oscuro');
            //se le esta poniendo un color a la notificacion, el color depende del tipo de notificacion de css.html
            break;
        }

      

        //Mostrar notificacion
        notificacion.show();

    }
</script>