<script>

    function crearTablaContactos()
    {
        eliminarTablaContactos();//borra la tabla si ya existe

        //creando el loader
        crearLoader('divContactos');//crea el loader en el divContactos



        //Hace la tabla hasta que la funcion obtenerContactos termine
        google.script.run
        .withSuccessHandler(crearTablaContactosCorrectamente)
        .withFailureHandler(creatTablaContactosError)//En caso de no obtener los contactos, se va hasta la funcion creatTablaContactosError
        .obtenerContactos();
    }  

    function crearTablaContactosCorrectamente(obj)//obj es el resultado de la funcion obtenerContactos
        {
            //creamos la tabla
            tabla = document.createElement('table');
            tabla.id = 'tablaContactos';

            let tablaHeader = document.createElement('thead');
            let tablaBody = document.createElement('tbody');

            //Empezamos creando el header de la tabla
            let primeraFila = document.createElement('tr');//creamos una fila

            for(let i=0; i<obj[0].length; i++)//saca los elementos de la cabezera
            {
                let celda = document.createElement('td');//creamos una celda por cada elemento de la matriz de excel
                    celda.textContent = obj[0][i];
                    primeraFila.appendChild(celda);//agregamos la celda a la fila pero en la pagina web
            }
            //si es la primera fila, la agregamos a la cabecera
            tablaHeader.appendChild(primeraFila);
            tabla.appendChild(tablaHeader);

            //Aqui empezamos a crear el cuerpo de la tabla
            for(let i=1; i< obj.length; i++)
            {
                let fila = document.createElement('tr');//creamos una fila
                for(let j=0; j< obj[i].length; j++)
                {
                    let celda = document.createElement('td');//creamos una celda por cada elemento de la matriz de excel
                    celda.textContent = obj[i][j];
                    fila.appendChild(celda);//agregamos la celda a la fila pero en la pagina web
                }
                    tablaBody.appendChild(fila);//agregamos la fila a la tabla pero en la pagina web
            }

            //agregamos clases a la cabecera
            tablaHeader.classList.add('table-dark');
            //agregamos el cuerpo de la tabla
            tabla.appendChild(tablaBody);
            //agregamos clases a la tabla
            tabla.classList.add('table', 'table-striped', 'border', 'border-4', 'border-dark');
            //agrega,la tabla a la pagina
            document.getElementById('divContactos').appendChild(tabla);//divContactos es el id del div que esta en Main.html
        
            //Mostrar una notificacion de exito
            crearNotificacionOk('Se han cargado los contactos correctamente', 'Todo en orden');

            //Elimina el loader
            eliminarLoader();
        }

    function creatTablaContactosError()
    {
        //Muestra una notificacion de error
        crearNotificacionError('No se han podido leer los contactos', 'ERROR');

         //Elimina el loader
         eliminarLoader();
    }

    function crearNotificacion(mensaje, titulo)
    {
        document.getElementById('mensajeNotificacion').textContent = mensaje;
        document.getElementById('tituloNotificacion').textContent = titulo;
        let elementoNotificacion = document.getElementById('notificacion');//Esto nos guarda la notificacion en una variable, main linea 16
        bootstrap.Toast.getOrCreateInstance(elementoNotificacion).show();//Esta instancia es para poder mostrarla
    }

    function crearNotificacionOk(mensaje, titulo)
    {
        crearNotificacion(mensaje,titulo);
        crearIconoNotificacionOk();
        crearColorNotificacion('--color-verde-oscuro');
    }

    function crearNotificacionError(mensaje, titulo)
    {
        crearNotificacion(mensaje,titulo);
        crearIconoNotificacionError();
        crearColorNotificacion('--color-rojo-oscuro');
    }

    function crearNotificacionWarning(mensaje, titulo)
    {
        crearNotificacion(mensaje,titulo);
        crearIconoNotificacionWarning();
        crearColorNotificacion('--color-amarillo-oscuro');
    }

    function crearIconoNotificacionOk()
    {
        document.getElementById('iconoNotificacion').className = ''; //limpia el icono
        document.getElementById('iconoNotificacion').classList.add('bi', 'bi-check2-square');//Este icono es de bootstrap
    }

    function crearIconoNotificacionError()
    {
        document.getElementById('iconoNotificacion').className = ''; //limpia el icono
        document.getElementById('iconoNotificacion').classList.add('bi', 'bi-bug');//Este icono es de bootstrap
    }

    function crearIconoNotificacionWarning()
    {
        document.getElementById('iconoNotificacion').className = ''; //limpia el icono
        document.getElementById('iconoNotificacion').classList.add('bi', 'bi-exclamation-square');//Este icono es de bootstrap
    }

    function crearColorNotificacion(color)
    {
        let elementoNotificacion = document.getElementById('notificacion');//Esto nos guarda la notificacion en una variable, main linea 16
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(color);
        //se le esta poniendo un color a la notificacion, el color depende del tipo de notificacion de css.html      
    }

    function crearLoader(elementoPadre)
    {
        eliminarLoader();
        let loader = document.createElement('div');//nos guardamos el loader en una variable
        loader.id = 'loader';
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.classList.add('lds-ellipsis');
        document.getElementById(elementoPadre).appendChild(loader);
    }

    function crearLoaderPuntos(elementoPadre)
    {
        let loader = crearLoader(elementoPadre);
        loader.classList.add('lds-ellipsis');
    }

    function crearLoaderAnillo(elementoPadre)
    {
        let loader = crearLoader(elementoPadre);
        loader.classList.add('lds-ring');
    }

    function eliminarLoader()
    {
        let loader = document.getElementById('loader');
        if(loader)
        {
            loader.remove();
        }
    }

    function eliminarTablaContactos()
    {
        let tabla = document.getElementById('tablaContactos');
        if(tabla)
        {
            tabla.remove();
        }
    }
</script>